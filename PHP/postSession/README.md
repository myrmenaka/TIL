# 2025.7.8 - 確認画面付きのフォーム処理（POSTとセッションの活用）

## 目的

POST送信とセッションを使って、「入力 → 確認 → 完了」の3画面構成フォームを作成し、実務でもよく使われる「確認画面付き送信処理」の流れを理解する

## 目次

- [フォーム処理の3ステップ構成](#1)
- [セッションを使う理由](#2)
- [基本的な流れ](#3)

## 学習内容

<a id="1"></a>

### フォーム処理の3ステップ構成

- 入力画面  
    - フォームをPOSTで送信すると `確認画面` に移動する
- 確認画面  
    - POSTで受け取り、セッションに保存  
    - 「修正する」ボタンと「送信する」ボタンを設置
    - `入力画面` から送信されてきた内容を取得し、表示する
- 完了画面  
    - 送信された内容を表示する  
    → セッションから表示、POSTの再送信を防ぐ

[参考: 入力画面、確認画面、完了画面を実装しよう](https://hackmd.io/@GH-wNvm-QfG5Y89-RmIY8g/HyEACrfK_)  

---
<a id="2"></a>

### セッションを使う理由

- POSTされたデータを、確認画面 → 完了画面 に引き継ぐ
- ブラウザの「戻る」や「リロード（再読み込み）」でもデータが保持される
- POST → リダイレクト → GET（PRGパターン）を使うと、二重送信防止にもなる

[参考: リダイレクトとは？初心者でも絶対分かる徹底解説｜設定方法も紹介](https://tms-partners.com/12216/)  
[参考: 新人Webエンジニア必須？の知識「PRGパターン」について](https://zenn.dev/imah/articles/3d186a6462ecc8)  
[参考: POST メソッドの多重送信を防ぐ PRG パターンとは](https://poco-tech.com/posts/spring-boot-introduction/post-redirect-get-pattern/)  

---
<a id="3"></a>

### 基本的な流れ

`入力画面`  
　↓  
`POST`  
　↓  
`確認画面`  
　↓  
`POST`  
　↓  
`処理`  
　↓  
`リダイレクト`  
　↓  
`完了画面`  

---
---
## セキュリティ面での注意

- フォームの値はサニタイズ（`htmlspecalchars()`）して表示
- `process.php` ではセッションの存在を必ず確認（直接アクセスの防止）
- セッションデータは `完了後に削除` し、`再送信やなりすましを防止`
- 入力値の検証（バリデーション）やトークンによるCSRF対策は、より実務的にする場合は必須


## 練習問題 

名前とメールアドレスを入力するフォームを作成し、`確認画面 → 完了画面` の流れを実装  

- input.php  
    → 入力画面
- confirm.php  
    → 確認画面
- process.php  
    → 処理・リダイレクト
- thanks.php  
    → 完了画面

## 作業チェックリスト

- 入力画面・確認画面・完了画面の3構成を作成したか
- セッションでデータを保持・受け渡しできたか
- `PRGパターン（POST → リダイレクト → GET）` で再送信防止できたか
- 出力時はすべて `htmlspecalchars()` を使ったか


## MEMO

- 

---

参考: []()
