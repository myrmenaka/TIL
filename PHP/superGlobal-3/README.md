# 2025.6.25 - 基本文法　フォームとPOST送信の応用

## 目的

- ユーザーからの複数データをPOST送信し、PHPで受け取って処理できるようになる
- フォームの構造とPOSTデータの関係性を理解する
- XSS対策を意識して安全に出力する

## 目次

- [複数の入力値をもつフォームの作成](#1)
- [複数のPOSTデータをPHPで受け取って処理](#2)
- [受け取ったデータを整形して表示（改行、結合など）](#3)
- [空欄チェック（バリデーション）の基礎](#4)

## MEMO

<a id="1"></a>

### 複数の入力値をもつフォームの作成

- フォームに `input` や `textarea` を複数配置することで、ユーザーからいろいろな情報を一度に受け取れる
- `name属性` を必ず設定しておくことで、送信後にPHP側で値を取得できる

例）
```html
<input type="text" name="name">
```
---
<a id="2"></a>

### 複数のPOSTデータをPHPで受け取って処理

- `$_POST['name']` のように、HTMLフォームで設定した `name` に対応するデータを受け取る
- 受け取った値は、直接出力せずに `安全な処理` を行うのが基本

---
<a id="3"></a>

### 受け取ったデータを整形して表示（改行、結合など）

- ユーザーが入力する文字列の中には改行（Enter）も含まれることがある
- 通常、HTMLでは（Enterでの）改行は無視されるため、`n12br()` 関数を使って `<br>` に変換することで、画面上で改行が反映される

例）
```php
echo n12br($message);
```

>`n12br()` : 改行文字の前に HTML の改行タグを挿入する  
>[参考: PHPマニュアル](https://www.php.net/manual/ja/function.nl2br.php)

---
<a id="4"></a>

### 空欄チェック（バリデーション）の基礎

- ユーザーが何も入力せずに送信するケースに備えて、「空欄だったらエラーを表示して処理を止める」ことが必要
- 条件分岐と併せて `empty()` 関数を使えば、`空文字` `NULL` `0` などをまとめてチェックできる  
    ※empty関数では、「空」として扱われる対象が多い  
    → 状況により、使い分けが必要  
    [空欄チェック: validation.md](validation.md)

例）
```php
if (empty($name)) {
    echo "名前を入力してください。";
    exit;
};
```

※if文の中でexitを使用すると、特定の条件が満たされた場合にスクリプトを中断し、それ以降の処理を実行しないように制御できる  

※`バリデーションチェック` :   
入力されたデータが、あらかじめ定められたルールや形式に合致しているかを確認する処理

---

## セキュリティ面での注意

- XSS対策  
    → 入力データは `htmlspecialchars()` でエスケープしないと危険
- 空欄チェック  
    → `empty()` を使って入力がない場合は処理を止めると安全
- メールアドレス形式の確認  
    → `filter_ver($email, FILTER_VALIDATE_EMAIL)` でチェックも可能（応用）

※エスケープ :  
意味を持つ特別な文字を、別の文字の組み合わせに置き換えたりして、普通の文字として認識させること

---

### 練習問題
名前・メールアドレス・好きな言葉を入力して、送信後にその入力データに基づいたメッセージが表示されるPHPアプリを作成してください  

---
## 作業チェックリスト

- 複数項目のフォームを作成した
- PHPでPOSTデータを受け取って表示できた
- `htmlspecialchars()` を使って安全に表示した
- `n12br()` を使って改行が反映されるようになった
- 空欄チェック `empty()` を追加した

---
## 疑問・課題

- 小さな一つのプログラムでも、様々なセキュリティ対策やユーザーのケースを考慮して作成するべきであると感じた
- 空欄チェックを追加後、すべて入力しても空欄と認識されてしまう状況になった  
→ 空欄チェックより前で、変数が未定義だったため、常に空と判定されていた

    <確認事項>
    - フォームの `name属性` とPHP側の `キー` が一致しているか
    - 変数に値を入れてから `empty()` を使っているか
    - ちゃんとPOSTメソッドでフォームを送信しているか

---

[リファレンス: references.md](references.md)

参考: []()
