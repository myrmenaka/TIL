# 2025.6.27 - 基本文法　チェックボックス・ラジオボタン・配列送信

## 目的

- `複数の選択肢（チェックボックス）`や`ラジオボタン`を扱えるようになる
- `フォームから配列としてデータを送る方法`を学ぶ
- 入力値の取り扱いでの注意点を理解する（セキュリティ含む）

## 目次

- [チェックボックスの基本](#1)
- [ラジオボタンの基本](#2)
- [配列データの受け取り方（PHP側）](#3)
- [チェックされなかったときの扱い](#4)

## MEMO

<a id="1"></a>

### チェックボックスの基本

複数の項目を同時に選べるのが `チェックボックス`  
```html
<input type="checkbox" name="hobby[]" value="映画">映画
<input type="checkbox" name="hobby[]" value="読書">読書
<input type="checkbox" name="hobby[]" value="スポーツ">スポーツ
```
→ `name="hobby[]"` のように、チェックボックスの`name属性` に `[]` をつけることで、複数の値を `配列として送信` できる  
この時の `name属性` は同一のものにする  
※`[]` をつけなかった場合はチェックボックスはひとつしか存在せず、選ばれた時だけ値が送られる  
※`[]` をつけない場合、配列として送信されず、`文字列` になる

上記の選択肢すべて選んで送信した場合、PHPでは以下のようになる  
```php
$_POST['hobby']

// → ["映画", "読書", "スポーツ"]となる
```    

---
<a id="2"></a>

### ラジオボタンの基本

ひとつしか選べない選択肢  
```html
<input type="radio" name="gender" value="男性">男性
<input type="radio" name="gender" value="女性">女性
```
→ `name` が同じで `value` が異なる場合、`どれかひとつだけ` 選ばれる

---
<a id="3"></a>

### 配列データの受け取り方（PHP側）

1. `$_POST['hobby']` に入っている配列を変数に代入する
2. `foreach` で `配列の中の要素` をひとつずつ取り出す
3. HTMLに出力するので、取り出した要素をエスケープしてから出力する
```php
$hobbyies = $_POST['hobby'];
foreach ($hobbyies as $hobby) {
    echo htmlspecialchars($hobby, ENT_QUOTES, 'UTF-8') . "<br>";
}
```

---
<a id="4"></a>

### チェックされなかったときの扱い

チェックボックスは `選ばれていないと送信されない` ため、存在を確認する  
```php
if (isset($_POST['hobby'])) {
    // hobbyが存在する（選択されている）
} else {
    echo "趣味が選択されていません。";
}
```
`is_set関数` → 変数が定義されていて、かつ NULLとは異なることを判定する  
[参考: PHPマニュアル isset](https://www.php.net/manual/ja/function.isset.php)  

※存在しない場合の処理のみの場合は、`!` で否定（反転）することで、else を省略可能  

---
## セキュリティ面での注意

- 入力の存在チェック `isset()` は必須  
→ チェックボックスなどは未選択だと送られないので注意  
- 値の取り出し前に `htmlspecialchars()` でエスケープ  
→ HTMLに表示するなら必ずサニタイズ 　
- 信頼せずにチェックする  
→ 値が「ラジオボタンの選択肢にない値」になっていてもおかしくないので、`値の妥当性チェック` も有効  

※  
`サニタイズ` は、不正なデータやコードを無害化する `包括的な処理` を指す  
`エスケープ` は、`特定の文字` を無害な文字に置き換える処理を指す  
`エスケープ` は `サニタイズ` の一種

---

### 練習問題 

1. ユーザーに性別と趣味を選んでもらい、入力内容をPHPで表示するフォームを作成  

2. ・好きなフルーツを選ぶチェックボックスを3つ用意  
    ・送信後選ばれたフルーツを表示  
    ・1つも選ばれなかった場合は「選択されていません」と表示

---
## 作業チェックリスト

- チェックボックスに `[]` をつけてフォームを作成した
- PHP側で `$_POST['hobby']` を配列で受け取った
- `foreach` を使って配列の中身を表示した
- `isset()` を使って選択されなかったケースも処理した  
- `サニタイズ処理` を忘れずに行った

---
## 疑問・課題

- チェックボックスの内容は自分で作成してるが、それでもエスケープが必要なのか  
→ たとえ、自分で作成したチェックボックスであっても、ユーザーが送る値は「改ざんできる」ためエスケープすべき  
- フォームは誰でも編集できる  
→ 改ざんされたまま出力してしまうと、ブラウザ上でスクリプトが実行され、攻撃される可能性がある  
- どんな値であっても、HTMLで出力する場合は必ず全てエスケープする  
→ 入力値が「安全かどうか」は、見た目では判断できない  
→ 信用できない値が混ざっているというのは、HTMLに表示するだけで脆弱性になる  

※意図的にエスケープしない場合もあるが、例外なので基本は「エスケープする」と覚えておく  

---

参考: []()
