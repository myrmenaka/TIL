# 2025.6.26 - 基本文法 8-1 フォーム入力チェック（バリデーション）と条件分岐

## 目的

- 入力内容の `条件チェック（バリデーション）` ができるようになる
- 条件によって処理を変える if文 の使い方を実践する
- 入力ミスに対して適切なエラーメッセージを出せるようになる

## 目次

- [`バリデーション（validation）` とは](#1)
- [PHPの if文 を使った条件チェック](#2)
- [メールアドレスの形式チェック](#3)
- [数値かどうかを確認](#4)

## MEMO

<a id="1"></a>

### `バリデーション（validation）` とは

入力内容が正しいかどうかをチェックすること  

例えば…
- メールアドレスの形式か
- 数値が入力されているか
- 必須項目が入力されているか  

このように、送信されたデータを信じず、安全かつ正しいかを確認するのが `バリデーション` 

---
<a id="2"></a>

### PHPの if文 を使った条件チェック

バリデーションは基本的に if文 を使って行う  

```php
if (empty($name)) {
    echo "名前を入力してください。";
}
```
---
<a id="3"></a>

### メールアドレスの形式チェック

`filter_var()関数` → `検証フィルター` で指定した形式か判定してくれる  
メールアドレスだけでなく、様々な形式をフィルタリングしてくれる便利な関数  
[PHPマニュアル : filter_var()](https://www.php.net/manual/ja/function.filter-var.php)  
[PHPマニュアル : 検証フィルター](https://www.php.net/manual/ja/filter.filters.validate.php)  

`FILTER_VALIDATE_EMAIL` → 値が妥当な e-mail アドレスであるかどうかを検証する  

```php
// メールアドレスのバリデーション
filter_var(対象の値, FILTER_VALIDATE_EMAIL)
```
※`対象の値` はフィルタリング処理の前に内部的に文字列に変換される  
※メールアドレスはRFC準拠していないものは、エラーと見なす（例 : `@` 直前に `.` や、`.` が連続したもの）  
[参考: PHPのfilter_var()関数を理解する](https://laranote.jp/php-filter-var-function/) より抜粋  

```php
if (!filter_var($email, FIKTER_VALIDATE_EMAIL)) {
    echo "正しいメールアドレスを入力してください。";
}
```
※`!` で否定することで、正式なメールアドレスの形式でない場合に true を返すようにしている  

---
<a id="4"></a>

### 数値かどうかを確認

`is_numeric()関数` → 値が数値形式の文字列（整数・小数）の場合に true を返す  
[PHPマニュアル : is_numeric()](https://www.php.net/manual/ja/function.is-numeric.php)

```php
is_numeric(対象の値)
```

```php
if (!is_numeric($age)) {
    echo "年齢は数字で入力してください。";
}
```
※`!` で否定することで、数値形式でない場合に true を返すようにしている  

---

## セキュリティ面での注意

- 入力の信用は絶対NG  
→ フォームに入力されていても、サーバー側で必ずチェック（バリデーション）をすること  
- `filter_var()` や `is_numeric()` を使う  
→ 型・形式チェックは脆弱性対策にもなる  
- エスケープ必須  
→ 最終的に出力する前には `htmlspecialchars()` を使って XSS を防ぐ

---

### 練習問題 

ユーザーに名前・メールアドレス・年齢を入力してもらい、バリデーションして表示するフォームを作成

---
## 作業チェックリスト

- `empty()` を使って空欄チェックをした
- `filter_var()` を使ってメール形式を確認した
- `is_numeric()` を使って年齢が数字か確認した
- 条件分岐でメッセージを分けて表示した
- エスケープ処理をすべての値に適用した

---
## 疑問・課題

- `exit;` の入力し忘れに注意する
- `n12br()` の認識違い訂正（ユーザー入力側の改行のこと）
- `is_numeric()` では、全角の数字もエラー対象になる
- バリデーションの際の `!` をなくすとどうなるのか  
→ 正式なメールアドレスや数値がはじかれるようになった → 間違えると大変なことになる

---

参考: []()
