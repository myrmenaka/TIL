# 2025.8.25 - ログイン機能の実装 1 会員登録とログイン処理

## 目的

Webアプリにログイン機能を実装し、ユーザーごとに利用できる仕組みを学ぶ  

## 目次

- [会員登録フォームの作成](#1)
- [会員登録処理](#2)
- [ログインフォームの作成](#3)
- [ログイン処理](#4)
- [ログイン状態の保持](#5)

## 学習内容

<a id="1"></a>

### 会員登録フォームの作成

- ユーザー名、メールアドレス、パスポートを入力できるフォームを作成
- パスワードは `ハッシュ化（password_hash()）` してDBに保存する  
    ※ハッシュ化とは  
    → データを特定のアルゴリズムで変換し、固定長の文字列を生成する処理  
    → この処理は不可逆的であり、一度ハッシュ化されたデータを元のデータに戻すことはできない  
    [参考: PHPマニュアル : password_hash](https://www.php.net/manual/ja/function.password-hash.php)  
    [参考: PHPマニュアル : 安全に、かつセキュアにパスワードをハッシュする](https://www.php.net/manual/ja/faq.passwords.php)  
    [参考: パスワードハッシュとは暗号の基礎](https://tuta.com/ja/blog/what-is-a-password-hash)  

---
<a id="2"></a>

### 会員登録処理

- DBにユーザー情報を `INSERT`  
    ※ `INSERT処理` は、`Day27`
- メールアドレスの重複チェックを行う

---
<a id="3"></a>

### ログインフォームの作成

- メールアドレスとパスワードを入力する

---
<a id="4"></a>

### ログイン処理

- メールアドレスでユーザーを検索
- 入力パスワードとDBのハッシュを、`password_verify()` で照合  
    [参考: PHPマニュアル : password_verify](https://www.php.net/manual/ja/function.password-verify.php)  
    [参考: PHPのpassword_verifyメソッドの使い方を現役エンジニアが解説【初心者向け】](https://magazine.techacademy.jp/magazine/21722)  
- 成功したら `セッションにユーザーIDを保存`

---
<a id="5"></a>

### ログイン状態の保持

- `$_SESSION['user_id']` をセットし、ログイン中かどうかを判定できるようにする

---
---
## セキュリティ面での注意

- パスワードは必ずハッシュ化して保存（平文保存は厳禁）
- SQLインジェクション対策のためプレースホルダを必ず使用
- セッションハイジャック対策として、ログイン後に `session_regenerate_id(true)` を行うのが望ましい
- メールアドレスの重複チェックを行うことで不正登録を防ぐ

## 練習問題 

会員登録・ログイン機能を実装する  

1. `register.php` で会員登録フォームを作成
2. DBにINSERTする際、パスワードをハッシュ化
3. `login.php` でログインフォームを作成
4. ログイン成功時にセッションを開始し、`$_SESSION['user_id']` に保存
5. ログイン中かどうかを判定できるようにする

## 作業チェックリスト

- 会員登録フォームが作成できたか
- パスワードをハッシュ化して保存できたか
- ログインフォームが作成できたか
- `password_verify()` で認証できたか
- セッションにユーザーIDを保存できたか

## MEMO

- `register.php` 解説  
- `login.php` 解説  

---

参考: []()
